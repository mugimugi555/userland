#!/bin/bash

echo "=========================================="
echo "🚀 Xvfb + VNC + XFCE4 + xfce4-goodies インストールスクリプト"
echo "=========================================="

# ======================================================================
# 必要なパッケージをインストール
# ======================================================================
echo "📌 Xvfb をインストール中..."
sudo apt update
sudo apt install -y xvfb x11-xserver-utils xauth tigervnc-standalone-server xfce4 xfce4-goodies

# ======================================================================
# VNC の初回設定（パスワード設定: userland）
# ======================================================================
echo "📌 VNC のパスワードを userland に設定..."
mkdir -p ~/.vnc
echo "userland" | vncpasswd -f > ~/.vnc/passwd
chmod 600 ~/.vnc/passwd

# ======================================================================
# VNC の xstartup 設定（XFCE4 を起動）
# ======================================================================
echo "📌 VNC の xstartup を XFCE4 に設定..."
cat <<EOF > ~/.vnc/xstartup
#!/bin/bash
export DISPLAY=:1
xrdb \$HOME/.Xresources
startxfce4 &
EOF
chmod +x ~/.vnc/xstartup

# ======================================================================
# VNC サーバーの起動
# ======================================================================
echo "📌 VNC サーバーを起動（ポート: 5901）..."
vncserver -kill :1 &> /dev/null
vncserver :1 -geometry 1280x720

# ======================================================================
# 接続情報を表示
# ======================================================================
LOCAL_IP=$(hostname -I | awk '{print $1}')
echo "=========================================="
echo "🎉 VNC サーバーのセットアップが完了しました！"
echo "📌 接続情報: $LOCAL_IP:5901"
echo "🔑 VNC パスワード: userland"
echo "🖥️ VNC クライアントで接続してください！"
echo "=========================================="
