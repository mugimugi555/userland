#!/usr/bin/bash

# ======================================================================================================================
# one liner command
# ======================================================================================================================
# wget https://raw.githubusercontent.com/mugimugi555/userland/main/ubuntu/install_lamp.sh && bash install_lamp.sh ;

# ======================================================================================================================
# install common and add repository
# ======================================================================================================================
sudo apt install -y software-properties-common ;
sudo add-apt-repository -y ppa:ondrej/php ;

# ======================================================================================================================
# install php mysql apache
# ======================================================================================================================
sudo apt install -y apache2 mariadb-server php php-{mysql,gd,imap,ldap,xml,curl,mbstring,zip};
php -v ;
#sudo a2dismod php7.4 ;
#sudo a2enmod php8.1 ;
#sudo update-alternatives --config php ;

# ======================================================================================================================
# set port number
# ======================================================================================================================
sudo sed -i '/Listen/{s/\([0-9]\+\)/8080/; :a;n; ba}' /etc/apache2/ports.conf

# ======================================================================================================================
# start auto
# ======================================================================================================================
echo "export LD_LIBRARY_PATH=\"\"" | sudo tee -a /support/startVNCServerStep2.sh ;
echo "/usr/sbin/apachectl start"   | sudo tee -a /support/startVNCServerStep2.sh ;
echo "sudo service mysql start"    | sudo tee -a /support/startVNCServerStep2.sh ;

# ======================================================================================================================
# start manually
# ======================================================================================================================
sudo service mysql start ;
/usr/sbin/apachectl start ;

# ======================================================================================================================
# finish
# ======================================================================================================================
LOCAL_IPADDRESS=`hostname -I | awk -F" " '{print $1}'` ;
echo "======================================" ;
echo "visit => http://$LOCAL_IPADDRESS:8080/" ;
echo "======================================" ;
